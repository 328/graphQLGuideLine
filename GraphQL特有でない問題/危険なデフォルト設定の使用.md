# 危険なデフォルト設定の使用

## 概要

GraphQLライブラリには、デフォルトで開発者向け機能が有効になっているものがあります。前述のIntrospection機能が代表例ですが、他にもエラーメッセージ中に不必要な情報が出力されることによりIntrospection機能がOffであってもSchemaを推測されたり、特定のURLで情報を受け取るがためにEndPointを推測されやすいといった問題があります。

## 影響

攻撃者にとって有用なシステムに関する情報を取得されるおそれがあります。

ただちに攻撃には繋がらないものの、他の攻撃の起点となるおそれがあります。

## 検証方法

以下のように存在しないクエリを送信した際に、レスポンスエラー中に存在するクエリの情報が出力された場合は、対策が必要です。

```graphql
{"query":"query\n{\nsysytem\n}"}
```

```json

{
   "errors": [
      {
         "message": "Cannot query field \"system\" on type \"Query\". Did you mean \"pastes\", \"paste\", \"systemUpdate\" or \"systemHealth\"?",
         "locations": [
            {
               "line": 2,
               "column": 2
            }
         ]
      }
   ]
}
```

エラー出力に起因するものに関しては、GraphQLのエラーだけではなく、データベースで生じたエラーの情報のようにバックエンドのシステム全体についてエラーメッセージから有用な情報が得られないか検証する必要があるため、ファジングやツールによるスキャンが有用です。

また、直接コードが閲覧できる場合は、GraphQLライブラリの設定や受け渡している引数がそのライブラリの公式ドキュメントやWebページ等で推奨されている方式であるか確認することも有力な検証方法の一つです。

## 対策

本番環境ではデバッグモードを有効にしないでください。

エラーメッセージは極力画面上に出力せず、ファイルやデータベース等に書き出すようにしましょう。

EndPoint URLはユーザにアクセスされるため一般的には公知ですが、ユーザに広く開示していない場合は単純な機械的アクセスによってEndPointを探索されることを避けるため、変更することを推奨します。

これらの設定が適切に行えないライブラリを利用する場合は、GraphQLサーバを直接ユーザが呼び出せないようにして、ユーザからの入力を受けてGraphQL EndPointに中継するサーバサイドプログラムを使用することで対策できます。

なお、必要な設定はライブラリによって異なるため、使用しているライブラリのドキュメントに従って本番環境向けの設定を行う必要があります。